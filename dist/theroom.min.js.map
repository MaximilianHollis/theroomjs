{"version":3,"sources":["theroom.js"],"names":["window","document","namespace","eventEmitter","event","eventController","target","options","inspector","excludedSelector","excludes","join","Array","prototype","slice","call","querySelectorAll","indexOf","type","pos","getBoundingClientRect","scrollTop","scrollY","documentElement","scrollLeft","scrollX","width","height","top","Math","max","left","style","engine","htmlEl","querySelector","blockRedirection","onbeforeunload","addEventListener","htmlClass","className","status","removeEventListener","replace","undefined","createInspector","arg","Error","start","opts","this","configure","el","Element","_inspector","createElement","body","appendChild","getInspector","stop","on","name","handler","opt","hasOwnProperty","applyOptions"],"mappings":"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","file":"theroom.min.js","sourcesContent":["(function (window, document, namespace) {\r\n  var status = 'idle'\r\n\r\n  // defaults\r\n  var options = {\r\n    inspector: null,\r\n    htmlClass: true,\r\n    blockRedirection: false,\r\n    createInspector: false,\r\n    excludes: []\r\n  }\r\n\r\n  var getInspector = function () {\r\n    if (typeof options.inspector === 'string') {\r\n      // if the provided inspector is a css selector, return the element\r\n      var el = document.querySelector(options.inspector)\r\n\r\n      if (el) return el\r\n      else throw Error('inspector element not found')\r\n    }\r\n\r\n    // eslint-disable-next-line\r\n    if (options.inspector instanceof Element) {\r\n      // if the provided inspector is a dom element, return it\r\n      return el\r\n    }\r\n\r\n    if (!options.inspector && options.createInspector) {\r\n      // create an inspector element\r\n      var _inspector = document.createElement('div')\r\n      _inspector.className = 'inspector-element'\r\n      document.body.appendChild(_inspector)\r\n      return _inspector\r\n    }\r\n\r\n    throw Error('inspector must be a css selector or a DOM element')\r\n  }\r\n\r\n  var getExclusionSelector = function () {\r\n    return options.excludes.join(',')\r\n  }\r\n\r\n  var applyOptions = function (opts) {\r\n    if (typeof opts !== 'object') throw Error('options is expected to be an object')\r\n\r\n    // merge\r\n    for (var opt in opts) {\r\n      // eslint-disable-next-line\r\n      if (opts.hasOwnProperty(opt)) {\r\n        options[opt] = opts[opt]\r\n      }\r\n    }\r\n  }\r\n\r\n  var eventEmitter = function (event) {\r\n    // hook event invocation\r\n    eventController('hook', event)\r\n\r\n    var target = event.target\r\n\r\n    // validation --skip inspector element itself--\r\n    if (!target || target === options.inspector) return\r\n\r\n    // do not inspect excluded elements\r\n    var excludedSelector = getExclusionSelector()\r\n    if (excludedSelector) {\r\n      var excludedElements = Array.prototype.slice.call(document.querySelectorAll(excludedSelector))\r\n      if (excludedElements.indexOf(target) >= 0) return\r\n    }\r\n\r\n    if (event.type === 'mouseover') {\r\n      // get target element information\r\n      var pos = target.getBoundingClientRect()\r\n      var scrollTop = window.scrollY || document.documentElement.scrollTop\r\n      var scrollLeft = window.scrollX || document.documentElement.scrollLeft\r\n      var width = pos.width\r\n      var height = pos.height\r\n      var top = Math.max(0, pos.top + scrollTop)\r\n      var left = Math.max(0, pos.left + scrollLeft)\r\n\r\n      // set inspector element position and dimension\r\n      options.inspector.style.top = top + 'px'\r\n      options.inspector.style.left = left + 'px'\r\n      options.inspector.style.width = width + 'px'\r\n      options.inspector.style.height = height + 'px'\r\n    }\r\n\r\n    // event invocation\r\n    eventController(event.type, target)\r\n  }\r\n\r\n  var engine = function (type) {\r\n    var htmlEl = document.querySelector('html')\r\n\r\n    if (type === 'start') {\r\n      if (options.blockRedirection === true) {\r\n        // block page redirection\r\n        window.onbeforeunload = function () {\r\n          return true\r\n        }\r\n      }\r\n\r\n      // bind event listeners\r\n      document.addEventListener('click', eventEmitter)\r\n      document.addEventListener('mouseover', eventEmitter)\r\n\r\n      // add namespace to HTML tag class list\r\n      if (options.htmlClass === true) htmlEl.className += ' ' + namespace\r\n\r\n      status = 'running'\r\n    } else if (type === 'stop') {\r\n      // remove binded event listeners\r\n      document.removeEventListener('click', eventEmitter)\r\n      document.removeEventListener('mouseover', eventEmitter)\r\n\r\n      // remove namespace from HTML tag class list\r\n      if (options.htmlClass === true) htmlEl.className = htmlEl.className.replace(' ' + namespace, '')\r\n\r\n      // remove blocking page redirection\r\n      if (options.blockRedirection === true) window.onbeforeunload = undefined\r\n\r\n      status = 'stopped'\r\n    }\r\n  }\r\n\r\n  var eventController = function (type, arg) {\r\n    if (!options[type]) return\r\n    if (typeof options[type] !== 'function') throw Error('event handler must be a function: ' + type)\r\n\r\n    // call the event\r\n    options[type].call(null, arg)\r\n  }\r\n\r\n  var start = function (opts) {\r\n    if (opts) {\r\n      this.configure(opts)\r\n    }\r\n\r\n    // get the inspector element\r\n    options.inspector = getInspector()\r\n\r\n    eventController('starting')\r\n\r\n    // start the inspection engine\r\n    engine('start')\r\n\r\n    eventController('started')\r\n  }\r\n\r\n  var stop = function () {\r\n    eventController('stopping')\r\n\r\n    // stop the inspection engine\r\n    engine('stop')\r\n\r\n    eventController('stopped')\r\n  }\r\n\r\n  var eventBinder = function (name, handler) {\r\n    if (typeof name !== 'string') throw Error('event name is expected to be a string but got: ' + typeof name)\r\n    if (typeof handler !== 'function') throw Error('event handler is not a function for: ' + name)\r\n\r\n    // update the event\r\n    options[name] = handler\r\n  }\r\n\r\n  // make it accessible from outside\r\n  window[namespace] = {\r\n    start: start,\r\n    stop: stop,\r\n    on: eventBinder,\r\n    configure: function (opts) {\r\n      // merge provided options with defaults\r\n      applyOptions(opts)\r\n    },\r\n    status: function () {\r\n      return status\r\n    }\r\n  }\r\n})(window, document, 'theRoom')\r\n"]}